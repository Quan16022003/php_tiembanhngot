{% extends 'layout.twig' %}

{% block title %}Danh sách User{% endblock %}
{% block content %}
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-1">
        <div class="input-group w-50">
            <select class="form-select" id="option">
                <option value="username">Tên đăng nhập</option>
                <option value="name">Họ tên</option>
            </select>
            <input type="text" class="form-control" id="search-text" placeholder="Tìm kiếm" aria-label="Tìm kiếm"
                   style="width: 150px" aria-describedby="button-search">
            <button class="btn btn-outline-secondary" type="button" id="button-search">Tìm kiếm</button>
        </div>
        <a href="/admin/user/add" class="btn btn-success">Thêm</a>
    </div>
    <div class="table-responsive small">
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Tên đang nhập</th>
                <th scope="col">Họ tên</th>
                <th scope="col">Ngày tạo</th>
                <th scope="col">Ngày chỉnh sửa</th>
                <th scope="col">Quyền</th>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            {% for user in list %}
                <tr>
                    <th scope="row">{{ user.id }}</th>
                    <td>{{ user.username }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.created_at }}</td>
                    <td>{{ user.modified_at }}</td>
                    <td>Quyền</td>
                    <td>
                        <a type="button" class="btn btn-primary btn-sm" href="/admin/user/edit?id={{ user.id }}">Sửa</a>
                        <button type="button" class="btn btn-danger btn-sm">Xóa</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        $(document).ready(function () {
            $('#button-search').click(function () {
                const searchOption = $('#option').val();
                const searchText = $('#search-text').val();
                console.log(searchOption);
                $.ajax({
                    type: 'POST',
                    url: '/admin/user/search',
                    data: {
                        option: searchOption,
                        text: searchText
                    },
                    success: function (data) {
                        data = JSON.parse(data);

                        $('tbody').empty();

                        // Thêm dữ liệu mới vào bảng
                        data.forEach(function (user) {
                            $('tbody').append(`
                            <tr>
                                <th scope="row">${user.id}</th>
                                <td>${user.username}</td>
                                <td>${user.name}</td>
                                <td>${user.created_at}</td>
                                <td>${user.modified_at}</td>
                                <td>Quyền</td>
                                <td>
                                    <a href="/admin/user/edit?id=${user.id}" type="button" class="btn btn-primary btn-sm">Sửa</a>
                                    <button type="button" class="btn btn-danger btn-sm">Xóa</button>
                                </td>
                            </tr>
                        `);
                        });
                    }
                });
            });
        });
    </script>
{% endblock %}