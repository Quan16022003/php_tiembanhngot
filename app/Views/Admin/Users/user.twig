{% set page = 'user' %}
{% extends './layout.twig' %}

{% block title %}Danh sách User{% endblock %}

{% block stylesheets %}
    <link href="https://cdn.datatables.net/v/bs5/jq-3.7.0/jszip-3.10.1/dt-2.0.6/b-3.0.2/b-colvis-3.0.2/b-html5-3.0.2/b-print-3.0.2/sp-2.3.1/datatables.min.css" rel="stylesheet">
    <style>
        .hide-arrow::after {
            display: none !important;
        }
    </style>
{% endblock %}

{% block content %}
    <h3 class="text-dark mb-4">Danh sách người dùng</h3>
    <div class="card shadow">
        <div class="card-header py-3">
            <p class="text-primary m-0 fw-bold">User info</p>
        </div>
        <div class="card-body">
            <div class="table-responsive table mt-2" id="dataTable" role="grid" aria-describedby="dataTable_info">
                <table id="example" class="table table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th>Người dùng</th>
                            <th>Quyền</th>
                            <th>Trạng thái</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for user in list %}
                        <tr>
                            <td>
                                <div class="d-flex justify-content-start align-items-center user-name">
                                    <div class="d-flex flex-column">
                                        <a href="/admin/user/view/{{ user.id }}" class="text-decoration-none text-primary">
                                            <span class="fw-medium">{{ user.name }}</span></a>
                                        <small class="text-muted">{{ user.email }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                {{ user.permission_name }}
                            </td>
                            <td>
                                {% if user.status == 0 %}
                                    <span class="badge bg-secondary">Chưa thay đổi mật khẩu mặc định</span>
                                {% elseif user.status == 1 %}
                                    <span class="badge bg-success">Đang hoạt động</span>
                                {% else %}
                                    <span class="badge bg-danger">Đã khóa</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-inline-block text-nowrap">
                                    <a class="btn btn-sm btn-primary" href="/admin/user/edit?id={{ user.id }}">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </a>
                                    <button class="btn btn-sm btn-primary delete-record">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                    <button class="btn btn-sm btn-primary dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                        <i class="fa-solid fa-ellipsis-vertical pe-1 ps-1"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end m-0">
                                        <a href="/admin/user/view/{{ user.id }}" class="dropdown-item">View</a>
                                        <a href="javascript:;" class="dropdown-item">Suspend</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th>Người dùng</th>
                        <th>Quyền</th>
                        <th>Trạng thái</th>
                        <th>Action</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/jszip-3.10.1/dt-2.0.6/b-3.0.2/b-colvis-3.0.2/b-html5-3.0.2/b-print-3.0.2/sp-2.3.1/sl-2.0.1/datatables.min.js"></script>


    <script>
    function deleteUser(userId) {
        if (confirm("Bạn có muốn xóa không?")) {
            $.ajax({
                type: 'POST',
                url: '/admin/user/delete',
                data: {
                    'id': userId
                },
                success: function(response) {
                    response = JSON.parse(response)
                    if (response.success) {
                        alert(response.message);
                        location.reload();
                    }
                },
                error: function(xhr, status, error) {
                    // Xử lý khi request thất bại
                    console.error(xhr.responseText);
                }
            });
        }
    }

    $(document).ready(function() {
        $('#example').DataTable({
            layout: {
                top2: {
                    searchPanes: {
                        initCollapsed: true,
                        collumns: [2]
                    }
                },
                top2Start: {
                    buttons: [
                        {
                            extend: 'copy',
                            text: '<i class="fa-solid fa-copy"></i> Copy'
                        },
                        {
                            extend: 'print',
                            text: '<i class="fa-solid fa-print"></i> In',
                            className: "btn"
                        },
                        {
                            extend: 'spacer',
                            style: 'bar',
                            text: 'Xuất files:'
                        },
                        {
                            extend: 'csv',
                            text: '<i class="fa-solid fa-file-csv"></i> CSV'
                        },
                        {
                            extend: 'pdf',
                            text: '<i class="fa-solid fa-file-pdf"></i> PDF'
                        }
                    ]
                },
                top2End: {
                    buttons: [
                        {
                            text: '<i class="fa-solid fa-plus"></i> Thêm người dùng mới',
                            className: "btn-primary",
                            action: function (e, dt, node, config) {
                                window.location.href = '/admin/user/add';
                            },
                            attr: {
                                'data-bss-hover-animate': 'pulse'
                            }
                        }
                    ]
                }
            },
            "language": {
                "decimal"       : "",
                "emptyTable"    : "Không có dữ liệu trong bảng",
                "info"          : "Hiển thị _START_ đến _END_ trong tổng số _TOTAL_ mục",
                "infoEmpty"     : "Hiển thị 0 đến 0 trong tổng số 0 mục",
                "infoFiltered"  : "(được lọc từ tổng số _MAX_ mục)",
                "infoPostFix"   : "",
                "thousands"     : ",",
                "lengthMenu"    : "Hiển thị _MENU_ mục",
                "loadingRecords": "Đang tải...",
                "processing"    : "",
                "search"        : "Tìm kiếm:",
                "zeroRecords"   : "Không tìm thấy bản ghi phù hợp",
            }
        });
        $('#example').DataTable().searchPanes.rebuildPane();
    });
</script>
{% endblock %}